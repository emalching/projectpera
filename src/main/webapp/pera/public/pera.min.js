(function(){var e=angular.module("peraApp",["ngRoute","ngSanitize","xeditable","pascalprecht.translate","ui.select","datetimepicker","ui.router"]);e.run(function(e,r){e.theme="bs3"});function r(e,r,t,a){a.otherwise("/");a.rule(function(e,r){var t=r.path();var a=t[t.length-1]==="/";if(a){var n=t.substr(0,t.length-1);return n}});r.state("home",{url:"/",templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).state("login",{url:"/login",templateUrl:"/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).state("register",{url:"/register",templateUrl:"/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).state("profile",{url:"/profile/:cardNumber",templateUrl:"/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).state("timesheet",{url:"/timesheet",templateUrl:"/timesheet/timesheet.view.html",controller:"timesheetCtrl",controllerAs:"vm"}).state("admin",{url:"/admin",templateUrl:"/admin/admin.view.html",controller:"adminCtrl",controllerAs:"vm"}).state("admin.holidays",{url:"/holidays",templateUrl:"/holidays/holidays.view.html",controller:"holidaysCtrl",controllerAs:"vm"}).state("admin.users",{url:"/users",templateUrl:"/users/users.view.html",controller:"usersCtrl",controllerAs:"vm"}).state("admin.batchrun",{url:"/batchrun",templateUrl:"/batchrun/batchrun.view.html",controller:"batchrunCtrl",controllerAs:"vm"});e.html5Mode({enabled:true,requireBase:false});t.useStaticFilesLoader({prefix:"/common/translations/locale-",suffix:".json"}).preferredLanguage("en")}angular.module("peraApp").config(["$locationProvider","$stateProvider","$translateProvider","$urlRouterProvider",r])})();(function(){angular.module("peraApp").controller("adminCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var t=this;t.isLoggedIn=r.isLoggedIn();t.currentUser=r.currentUser();if(t.currentUser.userType!="admin"){e.path("/login");return}t.logout=function(){r.logout();e.path("/login")}}})();(function(){angular.module("peraApp").controller("holidaysCtrl",e);e.$inject=["$scope","$location","$filter","holidayData","authentication"];function e(e,r,t,a,n){var i=this;i.currentUser=n.currentUser();if(i.currentUser.userType!="admin"){r.path("/login");return}i.pageHeader={title:"List of Holidays"};i.message="Loading the list of holidays...";i.formError="";a.getAllHolidays().success(function(r){i.message="";i.data=[];if(r.length!=0){i.data=r[0].holidayList}e.originalHolidayList=angular.copy(i.data);generateYearRange(i.data)}).error(function(e){i.message=e.message});i.yearRange=[];generateYearRange=function(e){var r=e.length;var t=new Date(e[0].date).getFullYear();var a=new Date(e[r-1].date).getFullYear();var n=(new Date).getFullYear();if(n<t){t=n}for(var o=0;t<=a;t++){i.yearRange.push(t);if(n>=t&&n<=a){i.selectedYear=i.yearRange[o]}o++}};i.criteriaMatch=function(e){return function(e){if(e.isDeleted){return false}return true}};e.cancel=function(){i.data=angular.copy(e.originalHolidayList);i.formError=""};e.isValidRow=function(e,r){var t=0;if(e.date){t++}if(r){t++}if(t!=2&&t!=0){i.formError="Date and Holiday must all be provided.";return" "}};e.updateHolidays=function(){for(var e=i.data.length;e--;){var r=i.data[e];if(r.isDeleted){i.data.splice(e,1)}if(r.isNew){r.isNew=false}}i.data=t("orderBy")(i.data,"date",false);a.updateHolidays({holidayList:i.data}).success(function(e){}).error(function(e){i.formError="Holiday list has not been updated, please try again."});i.yearRange=[];generateYearRange(i.data);return false};e.add=function(){i.data.push({date:"",holiday:"",isNew:true})};e.delete=function(e){i.data[e].isDeleted=true};i.goBack=function(){r.path("/")}}})();(function(){angular.module("peraApp").controller("homeCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var t=this;t.isLoggedIn=r.isLoggedIn();t.currentUser=r.currentUser();if(!t.isLoggedIn){e.path("/login");return}t.goToProfile=function(){e.path("/profile/"+t.currentUser.cardNumber)};t.goToTimesheet=function(){e.path("/timesheet")};t.goToAdmin=function(){e.path("/admin")};var a=4;var n=2;t.grid=3;if(t.currentUser.userType!="admin"){displayedButtons=a-n;if(displayedButtons==3){t.grid=4}else if(displayedButtons==2){t.grid=6}}}})();(function(){angular.module("peraApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var t=this;t.credentials={username:"",password:""};t.onSubmit=function(){t.formError="";if(!t.credentials.username||!t.credentials.password){t.formError="All fields required, please try again.";return false}else{r.login(t.credentials).error(function(e){t.formError=e}).success(function(r){e.path("/")})}}}})();(function(){angular.module("peraApp").controller("profileCtrl",e);e.$inject=["$scope","$stateParams","$location","staffData","userData"];function e(e,r,t,a,n){var i=this;i.cardNumber=r.cardNumber;i.pageHeader={title:"User Profile"};i.message="Loading your user profile...";i.loadError="";a.getStaffByCardNumber(i.cardNumber).success(function(e){i.message="";if(e[0].cardNumber!=""){i.data={staff:e[0]};if(!i.data.staff.employeeName){i.data.staff.employeeName=i.data.staff.firstName+" "+i.data.staff.lastName}}else{i.loadError="User Profile not found."}}).error(function(e){i.message="";i.loadError=e.message});n.getAllUsers().success(function(e){i.users=e}).error(function(e){i.message=e.message});e.updateProfile=function(){a.updateStaffByCardNumber(i.cardNumber,{employeeName:i.data.staff.employeeName,project:i.data.staff.project,department:i.data.staff.department,position:i.data.staff.position,teamLeadName:i.data.staff.teamLeadName}).success(function(e){}).error(function(e){i.formError="Your profile has not been updated, please try again."});return false};e.isEmpty=function(e,r){if(angular.isUndefined(r)||r===null||r.length<=0){return e+" is required."}};i.goBack=function(){t.path("/")}}})();(function(){angular.module("peraApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var t=this;t.credentials={username:"",cardNumber:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.username||!t.credentials.cardNumber){t.formError="All fields required, please try again.";return false}else{t.doRegister()}};t.doRegister=function(){t.formError="";r.register(t.credentials).error(function(e){t.formError=e.message}).then(function(){alert("Your card number has been registered successfully. Please continue logging in.");e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("peraApp").controller("timesheetCtrl",e);e.$inject=["$scope","$location","staffData","authentication"];function e(e,r,t,a){var n=this;n.isLoggedIn=a.isLoggedIn();if(!n.isLoggedIn){r.path("/login");return}n.cardNumber=a.currentUser().cardNumber;n.pageHeader={title:"User Timesheet"};n.message="Loading your user timesheet...";n.formError="";t.getStaffByCardNumber(n.cardNumber).success(function(r){n.message=r[0].cardNumber!=""?"":"User Profile not found.";n.data={staff:r[0]};e.originalTimeInOutList=angular.copy(r[0].timeInOutList);generateSemiMonthlyDateRange(n.data.staff.timeInOutList)}).error(function(e){n.message=e.message});n.semiMonthlyDataRange=[];generateSemiMonthlyDateRange=function(e){var r=e.length;var t=new Date(e[0].workDate);var a=new Date(e[r-1].workDate);var i=t.getDate();var o=t.getMonth()+1;var s=t.getFullYear();if(i<16){i="01"}else if(i<=31){i=16}t=new Date(s+"/"+o+"/"+i);var u=new Date;var l={normal:[31,28,31,30,31,30,31,31,30,31,30,31],leap:[31,29,31,30,31,30,31,31,30,31,30,31]};for(var c=0;t<=a;t.setMonth(t.getMonth()+1)){var i=t.getDate();var o=t.getMonth()+1;var s=t.getFullYear();if(o<10){o="0"+o}if(i==1){rangeStart=s+"/"+o+"/01";rangeEnd=s+"/"+o+"/15";n.semiMonthlyDataRange.push(rangeStart+" - "+rangeEnd);if(u>=new Date(rangeStart)&&u<=new Date(rangeEnd)){n.selectedDateRange=n.semiMonthlyDataRange[c]}c++}var f=new Date(s,1,29).getMonth()==1;if(f){i=l.leap[o-1]}else{i=l.normal[o-1]}rangeStart=s+"/"+o+"/16";rangeEnd=s+"/"+o+"/"+i;n.semiMonthlyDataRange.push(rangeStart+" - "+rangeEnd);if(u>=new Date(rangeStart)&&u<=new Date(rangeEnd)){n.selectedDateRange=n.semiMonthlyDataRange[c]}c++}};n.criteriaMatch=function(e){return function(r){itemDate=new Date(r.workDate);rangeStart=new Date(e.substring(0,10));rangeEnd=new Date(e.substring(13));if(itemDate>=rangeStart&&itemDate<=rangeEnd){return true}}};e.cancel=function(){n.data.staff.timeInOutList=angular.copy(e.originalTimeInOutList);n.formError=""};e.isValidRow=function(e,r){var t=0;if(e.timeInOverride){t++}if(e.timeOutOverride){t++}if(r){t++}if(t!=3&&t!=0){n.formError="New Time In, New Time Out, and Remarks must all be provided.";return" "}if(t==3&&e.timeInOverride>=e.timeOutOverride){n.formError="New Time In must be less than New Time Out.";return" "}};e.updateTimesheet=function(){t.updateTimesheetByCardNumber(n.cardNumber,{timeInOutList:n.data.staff.timeInOutList}).success(function(e){}).error(function(e){n.formError="Your timesheet has not been updated, please try again."});return false};n.goBack=function(){r.path("/")}}})();(function(){angular.module("peraApp").controller("usersCtrl",e);e.$inject=["$scope","$location","$filter","userData","authentication"];function e(e,r,t,a,n){var i=this;i.currentUser=n.currentUser();if(i.currentUser.userType!="admin"){r.path("/login");return}i.pageHeader={title:"List of Users"};i.message="Loading the list of users...";i.formError="";i.userTypes=[{value:"user",text:"user"},{value:"admin",text:"admin"}];a.getAllUsers().success(function(e){i.message="";i.data=e}).error(function(e){i.message=e.message});e.saveUser=function(e,r){return a.updateUserByCardNumber(r,{userType:e.userType}).success(function(e){}).error(function(e){i.formError="User with card number "+r+" has not been updated, please try again."})};i.goToProfile=function(e){r.path("/profile/"+e)};i.goToTimesheet=function(){r.path("/timesheet")};i.goBack=function(){r.path("/")}}})();(function(){angular.module("peraApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,r){var t=function(e){r.localStorage["pera-token"]=e};var a=function(){return r.localStorage["pera-token"]};var n=function(){var e=a();if(e){var t=JSON.parse(r.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var i=function(){if(n()){var e=a();var t=JSON.parse(r.atob(e.split(".")[1]));return{username:t.username,cardNumber:t.cardNumber,emailAddress:t.emailAddress,userType:t.userType}}};login=function(r){return e.post("/api/login",r).success(function(e){t(e.token)})};register=function(r){return e.post("/api/register",r).success(function(e){})};logout=function(){r.localStorage.removeItem("pera-token")};return{saveToken:t,getToken:a,isLoggedIn:n,currentUser:i,login:login,register:register,logout:logout}}})();(function(){angular.module("peraApp").service("holidayData",e);e.$inject=["$http","authentication"];function e(e,r){var t=function(){return e.get("/api/admin/holidays",{headers:{Authorization:"Bearer "+r.getToken()}})};var a=function(t){return e.put("/api/admin/holidays",t,{headers:{Authorization:"Bearer "+r.getToken()}})};return{getAllHolidays:t,updateHolidays:a}}})();(function(){angular.module("peraApp").service("staffData",e);e.$inject=["$http","authentication"];function e(e,r){var t=function(t){return e.get("/api/profile/"+t,{headers:{Authorization:"Bearer "+r.getToken()}})};var a=function(t,a){return e.put("/api/profile/"+t,a,{headers:{Authorization:"Bearer "+r.getToken()}})};var n=function(t,a){return e.put("/api/timesheet/"+t,a,{headers:{Authorization:"Bearer "+r.getToken()}})};return{getStaffByCardNumber:t,updateStaffByCardNumber:a,updateTimesheetByCardNumber:n}}})();(function(){angular.module("peraApp").service("userData",e);e.$inject=["$http","authentication"];function e(e,r){var t=function(){return e.get("/api/admin/users/",{headers:{Authorization:"Bearer "+r.getToken()}})};var a=function(t,a){return e.put("/api/admin/users/"+t,a,{headers:{Authorization:"Bearer "+r.getToken()}})};return{getAllUsers:t,updateUserByCardNumber:a}}})();(function(){angular.module("peraApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("peraApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var t=this;t.currentPath=e.path();t.isLoggedIn=r.isLoggedIn();t.currentUser=r.currentUser();t.logout=function(){r.logout();e.path("/login")}}})();(function(){angular.module("peraApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl",controllerAs:"navvm"}}})();(function(){angular.module("peraApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("peraApp").filter("propsFilter",e);function e(){return function(e,r){var t=[];if(angular.isArray(e)){var a=Object.keys(r);e.forEach(function(e){var n=false;for(var i=0;i<a.length;i++){var o=a[i];var s=r[o].toLowerCase();if(e[o].toString().toLowerCase().indexOf(s)!==-1){n=true;break}}if(n){t.push(e)}})}else{t=e}return t}}})();